BENHAMOUCHE Sofia M2BI - 2025/2026  
Projet court - Assignation et détection des parties transmembranaires d'une protéine  

# adptm Project

This repository implements a **pipeline to detect transmembrane regions** in proteins and estimate the position/thickness of the membrane using structural and solvent accessibility data.  

The workflow is inspired by *Tusnády, Dosztányi & Simon (2004, Bioinformatics)* and extended with scoring and visualization tools.  

---

##  Installation

### Download the repository

Download the ZIP repository.
In a proper folder, unzip it.
Change your current directory to the root of the project
```bash
cd adptm-project
```

### Virtual environment
We recommend using **Pixi** to manage dependencies.  
```bash
pixi install
pixi init
```
Required dependencies (core):
- Python ≥ 3.11  
- numpy, pandas, scipy  
- biopython (for PDB parsing)  
- DSSP (`mkdssp` binary must be installed)  
 ---

## Repository structure

```
adptm-project/
├─ data/              # Input files (PDB, DSSP, FASTA…)
│  ├─ prot.pdb
│  └─ prot.dssp
│
├─ results/           # Auto-generated outputs
│  ├─ 2025-09-08/     
│  │   ├─ prot_result.json
│  │   ├─ prot_annot.csv
│  │   └─ prot_view.png
│
├1─ src/               # Source code
│  ├─ main.py         # CLI pipeline entry point
│  ├─ detector.py     # Membrane detection algorithm
│  ├─ io_dssp.py      # PDB/DSSP I/O & RSA computation
│  ├─ membrane_viz.py # PyMOL visualization
│  └─ en.yml          # Pixi environment file (install with: pixi install -f src/en.yml)
│
├─ bin/               # External scripts (wrappers: mkdssp, pymol…)
└─ README.md          # This file

```

---

## Usage

### 1. Generate DSSP file
Install `mkdssp` and run:
```bash
pixi add conda-forge::dssp
pixi run -- mkdssp --version
```
```bash
pixi run mkdssp data/protein.pdb data/protein.dssp
```

### 2. Run detection pipeline
```bash
pixi run python src/main.py \
  --pdb data/protein.pdb \
  --dssp data/protein.dssp \
  --pdbid 1K24 \
  --dirs 30 --win 16 --bin 1 \
  --rsa-th 0.15 \
  --widen-step 1 --max-half-extra 30 \
  --lambda-penalty 1 -v
```

### Outputs

Each protein analyzed by the pipeline generates two main output files:

- **`<PDBID>_result.json`**  
  A JSON summary of the detected membrane placement, containing:
  - `origin`: coordinates of the membrane center
  - `normal`: orientation vector of the membrane
  - `d_in`, `d_out`: inner and outer boundary positions
  - `thickness`: membrane thickness (Å)
  - `Q`: quality score of the detection

   This file can be loaded with `membrane_viz.py` to visualize the membrane in PyMOL.

- **`<PDBID>_annot.csv`**  
  A CSV table with per-residue annotations:
  - Residue index and chain
  - Amino acid type
  - Cα coordinates
  - Solvent accessibility (RSA)
  - Transmembrane flag (`1 = TM`, `0 = non-TM`)


### 3. Visualize in PyMOL

open pymol
```pml
run /path/to/adptm-project/src/membrane_viz.py
memviz /path/to/adptm-project/data/protein.pdb, /path/to/adptm-project/outputs/protein_result.json
```
### PyMOL output

Running the visualization script in PyMOL produces:

- **Blue plane** → inner boundary of the membrane.  
- **Red plane** → outer boundary of the membrane.  
- **Protein cartoon** → displayed in cyan for context.  

This allows immediate inspection of the detected membrane orientation and thickness.
![PyMOL membrane visualization](outputs/1K24.png)



## Command-line options


### Positional arguments
| Argument  | Description |
|-----------|-------------|
| `--pdb <file>`   | Path to the input **PDB file** (protein structure with Cα atoms). |
| `--dssp <file>`  | Path to the input **DSSP file** generated by `mkdssp`. Contains solvent accessibility (ACC → RSA). |

### Optional arguments

| Option               | Default | Description |
|----------------------|---------|-------------|
| `--pdbid`            | STRUCT  | Identifier used in output names (e.g., `1K24`). |
| `--dirs`             | 30      | Number of directions sampled on the unit sphere (Fibonacci). |
| `--win`              | 16.0 Å  | Window width for Q-scoring (initial slab thickness before widening). |
| `--bin`              | 1.0 Å   | Slice thickness (bin size) for the 1D hydrophobicity profile. |
| `--rsa-th`           | 0.10    | RSA threshold for **exposure** (hard mode only). Residues with RSA ≥ threshold are counted as exposed. |
| `--rsa-quantile`     | None    | If set (0–1), overrides `--rsa-th` using a **global RSA quantile** (e.g., `0.25` = top 25% most exposed residues considered as exposed). |
| `--widen-step`       | 1.0 Å   | Increment step when widening the membrane slab. |
| `--max-half-extra`   | 30.0 Å  | Maximum additional **half-thickness** allowed beyond `win/2` during widening. |
| `--min-seg`          | 16 aa   | Minimal transmembrane segment length to be reported. |
| `--lambda-penalty`   | 1     | Penalty weight for hydrophiles included inside the slab. |
| `--out`              | outputs | Output directory for results (created if missing). |
| `-v`, `--verbose`    | False   | Enable verbose logging of progress and scores. |


---

##  References

- Tusnády, G. E., Dosztányi, Z., & Simon, I. (2004). *Transmembrane proteins in the Protein Data Bank: identification and classification.* Bioinformatics, 20(17), 2964–2972.  
- DSSP: Kabsch & Sander (1983), *Biopolymers* 22, 2577–2637.  
