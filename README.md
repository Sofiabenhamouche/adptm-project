BENHAMOUCHE Sofia M2BI - 2025/2026  
Projet court - Assignation et détection des parties transmembranaires d'une protéine  

# TMH Project

This repository implements a **pipeline to detect transmembrane regions** in proteins and estimate the position/thickness of the membrane using structural and solvent accessibility data.  

The workflow is inspired by *Tusnády, Dosztányi & Simon (2004, Bioinformatics)* and extended with scoring and visualization tools.  

---

##  Installation

### Download the repository

Download the ZIP repository.
In a proper folder, unzip it.
Change your current directory to the root of the project
```bash
cd tmh-project
```

### Virtual environment
We recommend using **Pixi** to manage dependencies.  

Example with pixi:
```bash
pixi install 
```

Required dependencies (core):
- Python ≥ 3.11  
- numpy, pandas, scipy  
- biopython (for PDB parsing)  
- DSSP (`mkdssp` binary must be installed)  
- PyMOL (for visualization, either licensed or open-source build)  

---

## Repository structure

```
tmh-project/
├─ data/              # Input files (PDB, DSSP, FASTA…)
│  ├─ 1K24.pdb
│  └─ 1K24.dssp
│
├─ results/           # Auto-generated outputs
│  ├─ 2025-09-08/     # Dated subfolders
│  │   ├─ 1K24_result.json
│  │   ├─ 1K24_annot.csv
│  │   └─ 1K24_view.png
│
├1─ src/               # Source code
│  ├─ main.py         # CLI pipeline entry point
│  ├─ detector.py     # Membrane detection algorithm
│  ├─ io_dssp.py      # PDB/DSSP I/O & RSA computation
│  ├─ membrane_viz.py # PyMOL visualization
│  ├─ __init__.py
│  └─ en.yml          # Pixi environment file (install with: pixi install -f src/en.yml)
│
├─ bin/               # External scripts (wrappers: mkdssp, pymol…)
└─ README.md          # This file

```

---

## Usage

### 1. Generate DSSP file
Install `mkdssp` and run:
```bash
mkdssp data/1K24.pdb data/1K24.dssp
```

### 2. Run detection pipeline
```bash
pixi run python src/main.py \
  --pdb data/1K24.pdb \
  --dssp data/1K24.dssp \
  --pdbid 1K24 \
  --dirs 30 --win 16 --bin 1 \
  --rsa-th 0.15 \
  --widen-step 1 --max-half-extra 30 \
  --lambda-penalty 0.7 -v
```

This produces:
- `results/1K24_result.json` → summary (origin, normal, d_in, d_out, Q, thickness…)  
- `results/1K24_annot.csv` → per-residue annotations with TM flags  

### 3. Visualize in PyMOL
```pml
run src/membrane_viz.py
memviz data/1K24.pdb, results/1K24_result.json
```
### PyMOL output

Running the visualization script in PyMOL produces:

- **Blue plane** → inner boundary of the membrane.  
- **Red plane** → outer boundary of the membrane.  
- **Protein cartoon** → displayed in cyan for context.  

This allows immediate inspection of the detected membrane orientation and thickness.


## Command-line options


### Positional arguments
| Argument  | Description |
|-----------|-------------|
| `--pdb <file>`   | Path to the input **PDB file** (protein structure with Cα atoms). |
| `--dssp <file>`  | Path to the input **DSSP file** generated by `mkdssp`. Contains solvent accessibility (ACC → RSA). |

### Optional arguments

| Option               | Default | Description |
|----------------------|---------|-------------|
| `--pdbid`            | STRUCT  | Identifier used in output names (e.g., `1K24`). |
| `--dirs`             | 30      | Number of directions sampled on the unit sphere (Fibonacci). |
| `--win`              | 16.0 Å  | Window width for Q-scoring (initial slab thickness before widening). |
| `--bin`              | 1.0 Å   | Slice thickness (bin size) for the 1D hydrophobicity profile. |
| `--rsa-th`           | 0.10    | RSA threshold for **exposure** (hard mode only). Residues with RSA ≥ threshold are counted as exposed. |
| `--rsa-quantile`     | None    | If set (0–1), overrides `--rsa-th` using a **global RSA quantile** (e.g., `0.25` = top 25% most exposed residues considered as exposed). |
| `--widen-step`       | 1.0 Å   | Increment step when widening the membrane slab. |
| `--max-half-extra`   | 30.0 Å  | Maximum additional **half-thickness** allowed beyond `win/2` during widening. |
| `--min-seg`          | 16 aa   | Minimal transmembrane segment length to be reported. |
| `--lambda-penalty`   | 0.8     | Penalty weight for hydrophiles included inside the slab. |
| `--out`              | outputs | Output directory for results (created if missing). |
| `-v`, `--verbose`    | False   | Enable verbose logging of progress and scores. |


---

##  References

- Tusnády, G. E., Dosztányi, Z., & Simon, I. (2004). *Transmembrane proteins in the Protein Data Bank: identification and classification.* Bioinformatics, 20(17), 2964–2972.  
- DSSP: Kabsch & Sander (1983), *Biopolymers* 22, 2577–2637.  
